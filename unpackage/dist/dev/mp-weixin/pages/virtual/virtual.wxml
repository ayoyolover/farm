<view class="container"><image class="background-image" src="/static/sow/back.png"></image><scroll-view style="{{'height:'+(windowHeight+'rpx')+';'}}" scroll-into-view="{{scrollToView}}" scroll-y="true" scroll-with-animation="{{true}}" enable-flex="true"><block wx:for="{{chatInfo.chatMessage}}" wx:for-item="item" wx:for-index="index"><view class="box" id="{{'msg'+index}}"><block wx:if="{{item.cmFlag}}"><view class="plant"><image class="avatar" src="/static/sow/sprout.png"></image><view class="content"><view class="message">{{item.cmContent}}</view></view></view></block><block wx:else><view class="user"><view class="userContent"><view class="message">{{item.cmContent}}</view></view><image class="avatar" src="/static/avatar.jpg"></image></view></block></view></block></scroll-view><block wx:if="{{audioDialogVisible}}"><view class="audio-dialog"><view data-event-opts="{{[['tap',[['closeAudioDialog',['$event']]]]]}}" class="close-btn" bindtap="__e">×</view><view class="audio-dialog-content"><view class="audio-text">绿宝发送了一条语音</view><view data-event-opts="{{[['tap',[['playAudio',['$event']]]]]}}" class="audio-btn" bindtap="__e">点击播放</view></view></view></block><view class="input-container"><view data-event-opts="{{[['tap',[['toggleVoiceInput',['$event']]]]]}}" class="icon-btn voice-btn" bindtap="__e"><text class="btn-text">{{isVoiceInput?'键盘':'语音'}}</text></view><block wx:if="{{!isVoiceInput}}"><view class="input-box"><input class="input" placeholder="请输入内容..." data-event-opts="{{[['input',[['__set_model',['','chatMsg','$event',[]]],['adjustInputHeight',['$event']]]]]}}" value="{{chatMsg}}" bindinput="__e"/></view></block><block wx:if="{{$root.g0}}"><view data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" class="icon-btn send-btn" bindtap="__e"><text class="btn-text">发送</text></view></block><block wx:if="{{isVoiceInput}}"><view data-event-opts="{{[['touchstart',[['startRecording',['$event']]]],['touchend',[['stopRecording',['$event']]]]]}}" class="voice-input-box" bindtouchstart="__e" bindtouchend="__e"><text class="voice-text">{{isRecording?'松开结束':'按住说话'}}</text></view></block><block wx:if="{{isRecording}}"><view class="recording-indicator"><image class="microphone-icon" src="/static/micro-white.png"></image><view class="recording-time">{{recordingTime+"s"}}</view></view></block></view><audio class="vue-ref" style="display:none;" id="audio" src="{{audio}}" data-ref="audio" data-event-opts="{{[['ended',[['onAudioEnded',['$event']]]]]}}" bindended="__e"></audio></view>